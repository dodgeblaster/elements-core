var i=0;function h(e){let t=document.createElement("canvas");t.setAttribute("id","canvas"),t.setAttribute("style","background: black"),e.appendChild(t)}function w(){let e=document.getElementById("canvas");e&&(e.remove(),i=0)}function y(){let e=document.getElementById("canvas");if(!e)throw new Error("Cannot find canvas element");return e}function p(e){h(e.div);let t=y();t.setAttribute("width",e.width.toString()),t.setAttribute("height",e.height.toString());let r=t.getContext("2d");if(!r)throw new Error("");r.imageSmoothingEnabled=!0,r.scale(2,2),window.devicePixelRatio=4;let a=()=>t.toDataURL("image/png");return{context:r,openImage:()=>{let o=a();Object.assign(document.createElement("a"),{target:"_blank",rel:"noopener noreferrer",href:o}).click()}}}function v(e){return t=>{e.fillStyle=t.color,e.fillRect(t.x+.5,t.y+.5,t.width,t.height)}}function x(e){return t=>{let r={small:18,normal:24,large:28},a=t.style||{color:"#222",weight:"normal",size:"normal"};return e.fillStyle=a.color,e.font=a.weight+" "+r[a.size]+"px sans-serif",e.fillText(t.text,t.x,t.y),e.measureText(t.text).width}}function k(e){return t=>{e.globalAlpha=t.alpha||1,e.drawImage(t.img,t.x,t.y),e.globalAlpha=1}}function E(e){e.clearRect(0,0,1610,1210)}function I(e,t){E(e),t({drawText:x(e),drawImage:k(e),drawRectangle:v(e)})}var c={setupScreen:p,teardownScreen:w,startGameLoop:(e,t)=>{window.requestAnimationFrame(r);function r(a){i===void 0&&(i=a);let n=a-i;I(e,t(n)),window.requestAnimationFrame(r)}}};function m(e){return t=>{t.sort((r,a)=>!r.layer&&!a.layer?0:r.layer?a.layer?r.layer<a.layer?-1:r.layer>a.layer?1:0:1:-1).forEach(r=>{r.type==="image"&&e.drawImage({img:r.img,x:r.x,y:r.y}),r.type==="text"&&e.drawText({text:r.text,x:r.x,y:r.y}),r.type==="rectangle"&&e.drawRectangle({color:r.color,x:r.x,y:r.y,height:r.height,width:r.width}),r.type||e.drawRectangle({color:r.color,x:r.x,y:r.y,height:r.height,width:r.width})})}}function d(e){let t=c.setupScreen({div:e.div,height:e.height,width:e.width});return{startGameLoop:r=>{c.startGameLoop(t.context,a=>n=>{let o=r(a);m(n)(o)})},takePicture:()=>{t.openImage()}}}function f(e,t){let r,a,n=0;return function(...l){let s=new Date().getTime();r&&clearTimeout(r),s-n>=t?(e(...l),n=s):(a=l,r=setTimeout(()=>{a&&(e(...a),n=new Date().getTime())},t-(s-n)))}}var u=(e,t)=>{(t||document).addEventListener("keypress",f(a=>{a.key==="o"&&e.menu(),a.key==="l"&&e.accept(),a.key===","&&e.cancel(),a.key==="d"&&e.right(),a.key==="s"&&e.down(),a.key==="a"&&e.left(),a.key==="w"&&e.up()},200))};function g(){let e={};return{on:(t,r)=>{e[t]||(e[t]=[]),e[t].push(r)},emit:(t,r)=>e[t]?(e[t].forEach(async a=>{await a(r)}),{success:!0,value:!0}):{success:!1,error:t+" is not a valid event"}}}var G={canvas:{makePixelCanvas:d},controllerInput:{setupKeyboard:u},events:{createEventBus:g}};export{G as elementsCore};
